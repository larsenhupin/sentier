<!DOCTYPE html>

<html>

<head>
    <title>Example 02.04 - Geometries</title>
    <script type="text/javascript" src="../libs/three.js"></script>
    <script type="text/javascript" src="../libs/stats.js"></script>
    <script type="text/javascript" src="../libs/dat.gui.js"></script>
	<script type="text/javascript" src="bigscreen.js"></script>
	<script type="text/javascript" src="pointerlock.js"></script>
    <style>
        body {
            /* set margin to 0 and overflow to hidden, to go fullscreen */
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>

<div id="Stats-output">
</div>
<!-- Div which will hold the Output -->
<div id="WebGL-output">
</div>

<!-- Javascript code that runs our Three.js examples -->
<script type="text/javascript">
	

	var renderer;
	var camera;
	var scene;
    // once everything is loaded, we run our Three.js stuff.
    function init() {

        

        // create a scene, that will hold all our elements such as objects, cameras and lights.
        scene = new THREE.Scene();

        // create a camera, which defines where we're looking at.
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 10000);
		
        // create a render and set the size
        renderer = new THREE.WebGLRenderer();

        renderer.setClearColor(0xffffff);
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = false;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
		
    
        // position and point the camera to the center of the scene
        
        camera.position.y = 400;
        camera.position.z = 400;
		camera.rotation.x = -45 * Math.PI / 180;

        // add subtle ambient lighting
        var ambientLight = new THREE.AmbientLight(0x090909);
		scene.add(ambientLight);

        // add spotlight for the shadows
        var spotLight = new THREE.SpotLight(0xffffff);
        spotLight.position.set(-40, 40, 50);
        spotLight.castShadow = true;
        //scene.add(spotLight);
		
		var directionalLight = new THREE.DirectionalLight(0xf6e86d, 1);
		directionalLight.position.set(1, 3, 2);
		scene.add(directionalLight);
		
		
		var floorGeometry = new THREE.PlaneGeometry(2000, 2000, 20, 20);
		var floorMaterial = new THREE.MeshBasicMaterial({color: 0x9db3b5, overdraw: true});
		var floor = new THREE.Mesh(floorGeometry, floorMaterial);
		floor.rotation.x = -90 * Math.PI / 180;
		scene.add(floor);
		
		// Original building
		var buildingGeometry = new THREE.CubeGeometry(1, 1, 1);
		buildingGeometry.applyMatrix(new THREE.Matrix4().makeTranslation(0, 0.5, 0));
		var buildingMaterial = new THREE.MeshPhongMaterial({overdraw: true, color: 0xcccccc});
		
		// Cloned building
		
		for (var i = 0; i < 300; i++){
			var building = new THREE.Mesh(buildingGeometry.clone(), buildingMaterial.clone());
			building.position.x = Math.floor(Math.random() * 200 - 100) * 4;
			building.position.z = Math.floor(Math.random() * 200 - 100) * 4;
			building.scale.x = Math.random() * 50 + 10;
			building.scale.y = Math.random() * building.scale.x * 8 + 8;
			building.scale.z = building.scale.x;
			
			scene.add(building);
		}
		
		document.getElementById('start').addEventListener('click', function()
		{
			if(BigScreen.enabled) {
				var instructions = this;
				BigScreen.request(document.body, function() {
					PL.requestPointerLock(document.body, function(){
						instructions.className = 'hidden';
						startAnimating();
					}, function(){
						stopAnimating();
					});
				}, function(){
					instructions.className = 'exited';
					stopAnimating();
				});
			}
		});
		document.getElementById("WebGL-output").appendChild(renderer.domElement);
		
    	}
		
        function render() {
            
				
            // render using requestAnimationFrame
            requestAnimationFrame(function animate(){
				renderer.render(scene, camera);
				//controls.update(clock.getDelta());
				requestAnimationFrame(animate);
			
			});
        }

	init();
	render();
	
	console.log(scene.children);
	
</script>
</body>
</html>